@using CriThink.Common.Endpoints.DTOs.Admin;
@model IList<DebunkingNewsGetAllResponse>;

@{
    Layout = "_LayoutApi";
    ViewData["Title"] = "Edit News";
}

<div class="bg-white p-4 shadow text-center m-4 mw-100">
	<h3 class="mb-3">Edit News</h3>
    	<div class="p-1 m-1">
		    <table class="table">
		        <thead>
		            <tr>
		                <th scope="col">Select</th>
		                <th scope="col">Title</th>
		                <th scope="col">Publisher</th>
		            </tr>
		        </thead>
		        @foreach(var c in Model)
		        {
		            <tr>
		                <td><input type="radio" name="allnews" value="@c.Id"></td>
		                <td>@c.Title</td>
		                <td>@c.Publisher</td>
		            </tr>
		        }
		    </table>

			@if(TempData["success"] != null)
			{
			    <div class="alert alert-success">@Html.Encode(TempData["success"])</div>
			}

			<div class="input-group mb-3">
            	<div class="input-group-prepend">
                	<span class="input-group-text">Keywords</span>
            	</div>
            	<input id="keywordsNews" type="text" class="form-control">
        	</div>

			<button id="editKeyword" class="btn btn-warning btn-block mb-3"><i class="fas fa-pen"></i></button>

			<!-- PageIndex nav -->
			<nav>
			  <ul class="pagination justify-content-center">
			    <li id="prevPage" class="page-item">
			      <a class="page-link pointer" aria-label="Previous">
			        <span>Previous</span>
			      </a>
			    </li>
			    <li class="page-item active"><a id="currentPage" class="page-link"></a></li>
			    <li class="page-item">
			      <a id="nextPage" class="page-link pointer" aria-label="Next">
			        <span>Next</span>
			      </a>
			    </li>
			  </ul>
			</nav>
			<!-- PageIndex nav -->

			<!-- PageSize nav -->
			<small>User for page</small>
			<nav>
			  <ul id="pageSizenav" class="pagination justify-content-center">
			    <li class="page-item pointer"><a asp-route-pageSize="20" asp-route-pageIndex="1" class="page-link">20</a></li>
			    <li class="page-item pointer"><a asp-route-pageSize="50" asp-route-pageIndex="1" class="page-link">50</a></li>
			    <li class="page-item pointer"><a asp-route-pageSize="100" asp-route-pageIndex="1" class="page-link">100</a></li>
			  </ul>
			</nav>
			<!-- PageSize nav -->

			<div class="mt-3 border-top pt-3">
			    <a asp-controller="DebunkingNews" asp-action="Index">Return to DebunkingNews</a>
			</div>
		</div>
</div>

@section Scripts
{
    <script type="text/javascript">
        $(function() {
			$('input[name="allnews"]').click(function(){
                let news = {}
                news.Id = $(this).val();
                $.post('@Url.Action("KeywordNews")', { request: news }, function(data){
                    $('#keywordsNews').val(data.keywords);
                })
                .fail(function(){
                    alert("Error");
                });
            });

			$('#editKeyword').click(function(){
				if(!$('input[name="allnews"]:checked').val()){alert("Please select news first")}
                let id = $('input[name="allnews"]:checked').val();
				let keywords = $('#keywordsNews').val();
                $.post('@Url.Action("EditNews")', { id: id, keywords:keywords }, function(data){
                    $('body').html(data);
                })
                .fail(function(){
                    alert("Error");
                });
            });

            let pageSize = parseInt(GetParameterValues('pageSize'));  
            let pageIndex = parseInt(GetParameterValues('pageIndex'));

            if(!pageSize || !pageIndex){
                pageSize = 20;
                pageIndex = 1;
            }

            let url = '@Url.Action("EditNewsView", "DebunkingNews")'.concat('?pageSize='+pageSize+'&pageIndex=');
            $('#nextPage').attr('href',url+(pageIndex+1));
            $('#prevPage').children().attr('href',url+(pageIndex-1));

            $('#currentPage').html(pageIndex);

            if (pageIndex == 1) {
                $('#prevPage').toggleClass('disabled');
            }

            function GetParameterValues(param) {  
                var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');  
                for (var i = 0; i < url.length; i++) {  
                    var urlparam = url[i].split('=');  
                    if (urlparam[0] == param) {  
                        return urlparam[1];  
                    }  
                }  
            };
        });
    </script>
}